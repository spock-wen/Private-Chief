# 小程序运行配置指南

## 快速配置步骤

### 1. 配置云开发环境

打开 `app.js`，修改云开发环境ID：

```javascript
wx.cloud.init({
  env: '你的云开发环境ID', // 在这里填写你的环境ID
  traceUser: true,
});
```

**如何获取环境ID：**
1. 登录微信公众平台
2. 进入"开发" -> "开发管理" -> "云开发"
3. 开通云开发（如果未开通）
4. 创建环境或使用已有环境
5. 复制环境ID

### 2. 配置小程序 AppID

打开 `project.config.json`，修改 AppID：

```json
{
  "appid": "你的小程序AppID"
}
```

**如何获取 AppID：**
1. 登录微信公众平台
2. 在"开发" -> "开发管理" -> "开发设置"中查看

### 3. 创建数据库集合

在微信开发者工具中：

1. 点击工具栏的"云开发"按钮
2. 进入"数据库"标签
3. 创建以下三个集合：
   - `tables` - 饭桌集合
   - `menus` - 菜单集合
   - `orders` - 订单集合

4. 为每个集合设置权限：
   - 点击集合名称
   - 点击"权限设置"
   - 建议选择："仅创建者可读写，所有人可读"

### 4. 部署云函数

在微信开发者工具中：

**方法一：批量部署**
1. 右键点击 `cloudfunctions` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

**方法二：逐个部署**
1. 右键点击每个云函数文件夹（如 `cloudfunctions/createTable`）
2. 选择"上传并部署：云端安装依赖"
3. 对以下所有云函数重复操作：
   - createTable
   - addDish
   - orderDish
   - confirmMenu
   - deleteDish
   - updateDish
   - deleteOrder
   - updateOrder

### 5. 准备图片资源（可选）

在 `images` 目录下添加以下图片：

- `logo.png` - Logo图片
- `home.png` / `home-active.png` - TabBar首页图标
- `history.png` / `history-active.png` - TabBar历史图标
- `default-dish.png` - 默认菜品图片

**如果没有图片：**
- 可以暂时使用占位图
- 或者修改 `app.json` 移除 TabBar 配置（删除 `tabBar` 部分）

### 6. 编译运行

1. 在微信开发者工具中点击"编译"按钮
2. 等待编译完成
3. 检查控制台是否有错误
4. 在模拟器中测试功能

## 常见问题排查

### 问题1: 云函数调用失败

**错误信息：** `cloud function error` 或 `云函数不存在`

**解决方法：**
1. 检查云函数是否已部署
2. 检查 `app.js` 中的环境ID是否正确
3. 在云开发控制台查看云函数列表
4. 查看云函数日志排查错误

### 问题2: 数据库查询失败

**错误信息：** `database error` 或权限错误

**解决方法：**
1. 检查数据库集合是否已创建
2. 检查集合权限设置
3. 在云开发控制台查看数据库集合

### 问题3: TabBar图标不显示

**错误信息：** 图标显示为空白

**解决方法：**
1. 检查 `images` 目录下是否有对应的图标文件
2. 图片路径是否正确
3. 或者暂时移除 `app.json` 中的 `tabBar` 配置

### 问题4: 页面无法打开

**错误信息：** `页面不存在` 或 `路径错误`

**解决方法：**
1. 检查 `app.json` 中的页面路径是否正确
2. 检查页面文件是否都存在（.js, .wxml, .wxss）
3. 检查文件命名是否正确

### 问题5: 数据无法显示

**可能原因：**
1. 数据库权限设置不正确
2. 查询条件错误
3. 数据尚未创建

**解决方法：**
1. 检查数据库权限
2. 在云开发控制台手动添加测试数据
3. 查看控制台错误信息

## 测试流程

### 1. 创建测试数据

在云开发控制台的数据库中，手动创建一个测试饭桌：

**tables 集合：**
```json
{
  "_id": "test_table_001",
  "name": "测试饭桌",
  "diningDate": "2024-01-20",
  "diningTime": "18:00",
  "status": "active",
  "createTime": "2024-01-19T10:00:00.000Z"
}
```

**menus 集合：**
```json
{
  "_id": "test_dish_001",
  "tableId": "test_table_001",
  "name": "宫保鸡丁",
  "category": "热菜",
  "price": 38,
  "status": "available",
  "createTime": "2024-01-19T10:05:00.000Z"
}
```

### 2. 测试功能

1. **测试创建饭桌**
   - 进入首页
   - 点击"创建饭桌"
   - 填写信息并创建

2. **测试添加菜品**
   - 进入菜单管理
   - 点击"添加菜品"
   - 填写菜品信息

3. **测试点菜**
   - 通过链接进入饭桌
   - 浏览菜单
   - 点击"+"点菜

## 开发建议

1. **使用真机调试**
   - 某些功能（如扫码）只能在真机上测试
   - 点击工具栏"预览"按钮，用微信扫码

2. **查看日志**
   - 在微信开发者工具中查看控制台
   - 在云开发控制台查看云函数日志和数据库日志

3. **逐步测试**
   - 先测试基础功能（创建饭桌、添加菜品）
   - 再测试复杂功能（点菜、查看订单）

4. **数据清理**
   - 测试时可以手动在数据库中删除测试数据
   - 或创建云函数定期清理过期数据

## 下一步

配置完成后，参考以下文档：
- `README.md` - 完整功能说明
- `DATABASE.md` - 数据库详细设计
- `QUICKSTART.md` - 快速开始指南


