# SpockChef 项目标准规范 (Project Standards & SOP)

> 本文档为项目开发的唯一事实来源（Source of Truth）。所有开发、设计工作必须严格遵循本文档定义的规范。
> **状态**: 🟢 已冻结 (Frozen) - 需求已确认，进入开发阶段。

---

## 1. 项目概况
*   **项目名称**: SpockChef 私厨 (Private Kitchen)
*   **核心目标**: 为家庭聚餐提供数字化助手，营造温馨、私密的宴客体验。
*   **技术栈 (Tech Stack)**:
    *   **前端 (front)**: Vue 3 + TypeScript + Vite + Tailwind CSS
    *   **后端 (background)**: NestJS + TypeScript + PostgreSQL (Prisma ORM)
    *   **架构模式**: 前后端分离 (RESTful API)

---

## 2. 核心功能架构规范 (Functional Architecture)

### 2.1 全量菜单库管理 (Global Menu Management)
*   **功能定位**: 独立于具体饭桌的后台管理模块，用于维护厨师的“全量武器库”。
*   **核心功能**:
    *   **CRUD 操作**: 支持全量菜品的增加、查询、修改、删除。
    *   **多维检索**: 支持按菜名关键字、菜品分类、口味标签进行实时搜索。
    *   **分类体系**: 固定枚举值 - **热菜, 凉菜, 汤, 主食, 饮料**。
    *   **菜品详情**:
        *   基本信息：菜名、描述、图片。
        *   特征标签：多选口味标签（如：微辣, 海鲜, 推荐）。
        *   安全信息：过敏原文本输入（如：花生, 虾）。
    *   **批量能力**: 支持 CSV/Excel 批量导入；支持勾选后批量删除或导出。

### 2.2 饭桌生命周期管理 (Table Lifecycle)
*   **状态机定义 (Status Machine)**:
    1.  **筹备中 (Planning)**:
        *   **主人端**: 创建饭桌信息（名称、时间、地点）；从全量菜单库中挑选“本场候选名单”。
        *   **权限**: 允许自由编辑饭桌信息和候选名单。
    2.  **投票中 (Voting)**:
        *   **主人端**: 生成 UUID 邀请链接/卡片；实时查看人气榜单。
        *   **权限**: **锁定**菜单库选择功能，禁止增删候选菜品，防止数据不一致。
        *   **客人端**: 点击链接 -> 填写名字及**忌口/偏好** -> 自动加入 -> 对候选菜品进行“点赞 (Like)”表态。
    3.  **已锁定 (Locked)**:
        *   **主人端**: 根据投票热度点击确认，生成最终上菜名单。
        *   **权限**: 停止接收投票，菜单完全冻结。
    4.  **已结束 (Archived)**:
        *   **主人端**: 开启账单结算功能；录入总支出。
        *   **权限**: 仅可查看历史记录，不可修改任何业务数据。

### 2.3 互动与决策逻辑 (Interactive Logic)
*   **模式 A (主厨拟单模式)**: 主人预选 -> 客人表态 -> 主人决策。
*   **身份管理**: 使用 Browser Session 标记匿名身份，支持 24 小时内同设备自动关联身份，无需强制登录。
*   **实时性**: 投票页面需实时展示当前各菜品的人气榜单（人气值 = 点赞数）。

### 2.4 账单结算规范 (Bill Settlement)
*   **触发前提**: 仅在饭桌状态为 **已锁定 (Locked)** 或 **已结束 (Archived)** 时可见。
*   **逻辑流程**:
    1.  主人录入本次聚餐的总支出金额。
    2.  系统自动获取当前饭桌已加入的有效 Session 人数。
    3.  **计算公式**: `人均费用 = 总金额 / 参与人数`（保留两位小数）。
    4.  **异常处理**: 若人数为 0，需提示“暂无参与客人，无法计算 AA”。

---

## 3. UI/UX 设计规范 (Design System)

### 3.1 视觉主题
*   **风格关键词**: Warm (温暖), Gathering (聚会), Private (私密)。
*   **标准色板**:
    *   `Primary`: `#D97706` (琥珀金) - 核心动作与状态。
    *   `Background`: `#FFFBF0` (暖米白) - 全局底色。
    *   `Text`: `#431407` (深褐) - 文本与内容。
*   **组件风格**:
    *   圆角: 统一 `16px` (大圆角)。
    *   阴影: 暖色调弥散阴影 (`rgba(217, 119, 6, 0.15)`)。

### 3.2 交互原则
*   **分类持久化**: 在菜品选择器中切换分类时，需保持当前搜索关键字。
*   **反馈机制**: 所有状态变更（如加入菜品、切换状态）必须有即时 Toast 提示。
*   **空状态**: 列表为空时，必须展示引导文案和插画占位。

---

## 4. 开发工作流 (SOP)
1.  **需求阶段**: 产品经理确认规范文档。
2.  **设计阶段**: 根据规范输出 UI 组件。
3.  **开发阶段**: 严禁擅自修改字段定义或状态机逻辑。
4.  **验收阶段**: 逐条核对 AC (Acceptance Criteria)。

---

## 5. AI 协作规范

### 5.1 🌐 语言规范 (Language Rules)
- **全局中文输出**：所有窗口的对话内容、思考过程（Thought）、推理分析、代码注释说明及用户交互文本，**必须**统一使用中文输出。
- **适用范围**：包括但不限于：主对话窗口、子任务代理（Sub-agent）、计划模式、问题澄清、Todo 列表描述、提交信息摘要等所有文本输出场景。
- **例外情况**：代码本身（变量名、函数名、语法关键字）、技术术语的英文原文引用、以及第三方工具的固定输出格式不受此限制。

### 5.2 🤝 协作与决策流程 (Collaboration & Decision)
1. **先澄清，后行动**：
   - 当用户的指令存在歧义、上下文缺失或多种解释可能时，**必须**在执行前先提出澄清问题。
   - 严禁在未确认需求的情况下根据猜测编写大量代码。

2. **多方案咨询**：
   - 针对架构设计、库的选择或复杂逻辑实现，始终至少提供 **两种** 替代解决方案。
   - **禁止**直接给出单一实现而不解释理由。

3. **结构化利弊分析**：
   - 每个提供的解决方案必须包含以下三个要素：
     - ✅ **优点 (Pros)**：为什么选它？
     - ⚠️ **缺点 (Cons)**：有什么代价或风险？
     - 🎯 **推荐场景 (Best for)**：什么情况下最适用？

4. **决策权归属**：
   - 提供专业建议和倾向性意见，但**最终决策权**始终归用户所有。
   - 在涉及重大变更时，需明确询问：“您希望采用哪种方案？”

### 5.3 🛠️ 技能调用规范 (Skill Invocation Rules)
1. **产品需求变更 (Product Requirements Change)**:
   - 每次涉及产品需求变更时，**必须**引入 `product-manager-toolkit` 技能进行分析和规划。

2. **界面变更 (UI/UX Changes)**:
   - 每次涉及界面（UI）设计或修改时，**必须**调用 `ui-ux-pro-max` 技能以确保设计质量。
