<!--pages/host/menu-manage/menu-manage.wxml-->
<view class="container">
  <view class="header-actions">
    <button class="btn-secondary" bindtap="shareTable" wx:if="{{tableId}}">分享饭桌</button>
    <button class="btn-primary" bindtap="addDish">添加菜品</button>
  </view>

  <view class="table-info card" wx:if="{{tableInfo}}">
    <text class="table-name">{{tableInfo.name}}</text>
    <text class="table-time" wx:if="{{tableInfo.diningDate}}">{{tableInfo.diningDate}} {{tableInfo.diningTime}}</text>
  </view>

  <view class="menu-tabs">
    <view class="tab-item {{currentCategory === 'all' ? 'active' : ''}}" bindtap="switchCategory" data-category="all">
      全部
    </view>
    <view class="tab-item {{currentCategory === item ? 'active' : ''}}" wx:for="{{categories}}" wx:key="*this" bindtap="switchCategory" data-category="{{item}}">
      {{item}}
    </view>
  </view>

  <view class="dish-list" wx:if="{{!error}}">
    <view class="dish-item card" wx:for="{{filteredDishes}}" wx:key="id">
      <image class="dish-image" src="{{item.image || '/images/default-dish.png'}}" mode="aspectFill"></image>
      <view class="dish-info">
        <view class="dish-header">
          <text class="dish-name">{{item.name}}</text>
          <view class="dish-header-right">
            <view class="dish-status">
              <text class="status-tag recommended" wx:if="{{item.status === 'recommended'}}">推荐</text>
              <text class="status-tag soldout" wx:if="{{item.status === 'soldout'}}">售罄</text>
            </view>
            <view class="more-btn" catchtap="showDishOptions" data-id="{{item.id}}">...</view>
          </view>
        </view>
        <text class="dish-desc">{{item.description}}</text>
        <view class="dish-footer">
          <text class="dish-price">¥{{item.price}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="empty-state" wx:if="{{filteredDishes.length === 0 && !loading && !error}}">
    <view class="empty-icon">🍽️</view>
    <text class="empty-text">暂无菜品，点击上方按钮添加</text>
  </view>

  <!-- 错误提示 -->
  <view class="error-state" wx:if="{{error}}">
    <text class="error-text">{{error}}</text>
    <button class="btn-primary" bindtap="loadMenu">重试</button>
  </view>

  <view class="bottom-actions" wx:if="{{tableId}}">
    <button class="btn-primary" bindtap="viewOrders">查看点菜情况</button>
  </view>
</view>

<!-- 添加/编辑菜品弹窗 -->
<view class="modal {{showModal ? 'show' : ''}}" bindtap="closeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">{{editingDish ? '编辑菜品' : '添加菜品'}}</text>
      <text class="modal-close" bindtap="closeModal">×</text>
    </view>
    <view class="modal-body">
      <view class="input-group">
        <text class="input-label">菜品图片</text>
        <view class="image-uploader" bindtap="chooseImage">
          <image wx:if="{{dishForm.image}}" src="{{dishForm.image}}" mode="aspectFill" class="uploaded-image"></image>
          <view wx:else class="upload-placeholder">
            <text class="upload-icon">+</text>
            <text class="upload-text">点击上传图片</text>
          </view>
        </view>
      </view>
      <view class="input-group">
        <text class="input-label">菜品名称 *</text>
        <input class="input-field" placeholder="如：宫保鸡丁" value="{{dishForm.name}}" bindinput="onDishNameInput" />
      </view>
      <view class="input-group">
        <text class="input-label">分类</text>
        <picker mode="selector" range="{{categories}}" value="{{categoryIndex}}" bindchange="onCategoryChange">
          <view class="picker-view">{{dishForm.category || '选择分类'}}</view>
        </picker>
      </view>
      <view class="input-group">
        <text class="input-label">价格 (元)</text>
        <input class="input-field" type="digit" placeholder="0.00" value="{{dishForm.price}}" bindinput="onPriceInput" />
      </view>
      <view class="input-group">
        <text class="input-label">描述</text>
        <textarea class="textarea-field" placeholder="菜品描述" value="{{dishForm.description}}" bindinput="onDescriptionInput" maxlength="200" />
      </view>
      <view class="input-group">
        <text class="input-label">菜品状态</text>
        <picker mode="selector" range="{{statusOptions}}" value="{{statusIndex}}" bindchange="onStatusChange">
          <view class="picker-view">{{dishForm.statusText || '可选择'}}</view>
        </picker>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-secondary" bindtap="closeModal">取消</button>
      <button class="btn-primary" bindtap="saveDish">保存</button>
    </view>
  </view>
</view>


