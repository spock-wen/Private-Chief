# 🚀 小程序运行指南

## 快速开始（3步配置）

### 第1步：配置云开发环境ID

打开 `app.js` 文件，找到第9行，修改为你的云开发环境ID：

```javascript
wx.cloud.init({
  env: 'your-env-id', // 👈 在这里填入你的环境ID
  traceUser: true,
});
```

**如何获取环境ID？**
1. 打开微信开发者工具
2. 点击顶部工具栏的"云开发"按钮
3. 如果未开通，先开通云开发服务
4. 创建环境或使用已有环境
5. 在环境名称旁边可以看到环境ID

### 第2步：配置小程序 AppID

打开 `project.config.json` 文件，找到第24行，修改为你的 AppID：

```json
{
  "appid": "your-appid"  // 👈 在这里填入你的 AppID
}
```

**如何获取 AppID？**
1. 登录微信公众平台：https://mp.weixin.qq.com/
2. 在"开发" -> "开发管理" -> "开发设置"中查看 AppID

### 第3步：创建数据库集合

1. 在微信开发者工具中点击"云开发"按钮
2. 进入"数据库"标签
3. 点击"+"创建集合，依次创建：
   - `tables` （饭桌）
   - `menus` （菜单）
   - `orders` （订单）

4. 为每个集合设置权限：
   - 点击集合名称进入详情
   - 点击"权限设置"
   - 选择："仅创建者可读写，所有人可读"

### 第4步：部署云函数

在微信开发者工具中：

**方法一：批量部署（推荐）**
1. 右键点击 `cloudfunctions` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待所有云函数部署完成

**方法二：逐个部署**
1. 右键点击每个云函数文件夹（如 `cloudfunctions/createTable`）
2. 选择"上传并部署：云端安装依赖"
3. 重复操作，部署以下所有云函数：
   - ✅ createTable（创建饭桌）
   - ✅ addDish（添加菜品）
   - ✅ orderDish（点菜）
   - ✅ confirmMenu（确认菜单）
   - ✅ deleteDish（删除菜品）
   - ✅ updateDish（更新菜品）
   - ✅ deleteOrder（删除订单）
   - ✅ updateOrder（更新订单）

**如何确认部署成功？**
- 在云开发控制台的"云函数"标签中，应该能看到所有8个云函数
- 每个云函数的状态显示为"正常"

### 第5步：准备图片资源（可选）

如果没有图片资源，可以暂时跳过这一步。TabBar 图标会显示为空白，但不影响核心功能。

如果需要添加图片：
1. 在 `images` 目录下添加以下文件：
   - `logo.png` - Logo图片
   - `home.png` 和 `home-active.png` - 首页TabBar图标
   - `history.png` 和 `history-active.png` - 历史TabBar图标
   - `default-dish.png` - 默认菜品图片

2. 或者暂时移除 TabBar：
   - 打开 `app.json`
   - 删除或注释掉 `tabBar` 配置部分（第19-37行）

### 第6步：编译运行

1. 在微信开发者工具中点击"编译"按钮（或按 Ctrl+B）
2. 等待编译完成
3. 查看控制台是否有错误信息
4. 如果没有错误，小程序应该能正常运行了！

## 🧪 测试功能

### 1. 测试创建饭桌

1. 进入首页
2. 点击"创建饭桌"卡片
3. 填写饭桌信息：
   - 饭桌名称：测试饭桌
   - 选择日期和时间
   - 可填写备注
4. 点击"创建饭桌"按钮
5. 应该跳转到菜单管理页面

### 2. 测试添加菜品

1. 在菜单管理页面，点击"添加菜品"按钮
2. 填写菜品信息：
   - 菜品名称：宫保鸡丁
   - 分类：热菜
   - 价格：38
   - 描述：经典川菜
3. 点击"保存"
4. 应该能看到菜品显示在列表中

### 3. 测试点菜功能

1. 在菜单管理页面，点击"分享饭桌"
2. 选择"复制链接"
3. 在小程序中点击"进入饭桌"
4. 粘贴饭桌ID（从链接中提取）或使用测试饭桌ID
5. 输入昵称，点击"确认进入"
6. 应该能看到菜单列表
7. 点击"+"按钮点菜
8. 应该能看到数量增加

## ⚠️ 常见问题

### Q1: 云函数调用失败

**错误信息：** `cloud function error: function not found`

**解决方法：**
1. 确认云函数已全部部署
2. 在云开发控制台的"云函数"标签中检查是否能看到所有函数
3. 检查函数名称是否正确（大小写敏感）
4. 重新部署失败的云函数

### Q2: 数据库查询失败

**错误信息：** `database error` 或权限错误

**解决方法：**
1. 确认数据库集合已创建（tables, menus, orders）
2. 检查集合权限设置
3. 在云开发控制台的"数据库"标签中查看集合列表

### Q3: 页面无法打开

**错误信息：** `页面路径不存在`

**解决方法：**
1. 检查 `app.json` 中的页面路径是否正确
2. 确认所有页面文件都存在（.js, .wxml, .wxss）
3. 检查文件命名是否一致

### Q4: TabBar图标不显示

**现象：** 底部导航栏图标显示为空白

**解决方法：**
1. 检查 `images` 目录下是否有对应的图标文件
2. 或者暂时移除 `app.json` 中的 `tabBar` 配置

### Q5: 编译报错

**解决方法：**
1. 查看控制台的详细错误信息
2. 检查语法错误
3. 确认所有引用的文件路径正确

## 📱 真机测试

1. 在微信开发者工具中点击"预览"按钮
2. 用微信扫描二维码
3. 在手机上测试功能

**注意：** 扫码功能只能在真机上测试

## 🔍 调试技巧

1. **查看控制台日志**
   - 在微信开发者工具中打开"控制台"标签
   - 查看是否有错误或警告信息

2. **查看云函数日志**
   - 在云开发控制台进入"云函数"标签
   - 点击云函数名称进入详情
   - 查看"日志"标签中的执行记录

3. **查看数据库数据**
   - 在云开发控制台进入"数据库"标签
   - 点击集合名称查看数据
   - 可以手动添加测试数据

## 📚 更多帮助

- 查看 `README.md` 了解完整功能
- 查看 `DATABASE.md` 了解数据库设计
- 查看 `QUICKSTART.md` 了解详细配置步骤

## ✅ 检查清单

在运行前，确认以下配置已完成：

- [ ] 已配置云开发环境ID（app.js）
- [ ] 已配置小程序AppID（project.config.json）
- [ ] 已创建数据库集合（tables, menus, orders）
- [ ] 已设置集合权限
- [ ] 已部署所有云函数（8个）
- [ ] 编译无错误
- [ ] 可以正常打开首页

如果以上都完成了，小程序应该可以正常运行了！🎉


